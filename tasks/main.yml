---
- include: pyenv.yml
  tags:
    - pyenv

- name: Install python versions
  tags:
    - versions
  command: "{{ pyenv_root }}/bin/pyenv install {{ item }}"
  args:
    creates: "{{ pyenv_root }}/versions/{{ item }}"
  with_items: "{{ pyenv_versions }}"

- name: Set global python version
  tags:
    - global
  lineinfile:
    path: "{{ pyenv_root }}/version"
    regexp: "^{{ pyenv_global_version }}"
    line: "{{ pyenv_global_version }}"
    create: yes
  when: pyenv_global_version is defined

- include: project.yml
  tags:
    - projects
  with_items: "{{ pyenv_project_versions }}"
  loop_control:
    loop_var: outer_project
