---
- include: pyenv.yml

- name: Install versions
  command: creates={{ pyenv_root }}/versions/{{ item }} {{ pyenv_root }}/bin/pyenv install {{ item }}
  with_items: "{{ pyenv_versions }}"

- include: versions.yml
  versions: "{{ pyenv_default_versions }}"
  dest: "{{ pyenv_root }}/version"

- include: versions.yml
  versions: "{{ pyenv_project_versions }}"
  dest: "{{ pyenv_project_root }}/.python-version"

- name: Add pyenv to run commands
  blockinfile:
    path: "{{ pyenv_runcom }}"
    marker: "# {mark} pyenv"
    state: present
    create: yes
    content: |
      if [ -f {{ pyenv_root }}/bin/pyenv ]; then
          export PYENV_ROOT="$HOME/.pyenv"
          export PATH="$PYENV_ROOT/bin:$PATH"
          eval "$(pyenv init -)"
      fi

- name: Add virtualenv to run commands
  lineinfile:
    path: "{{ pyenv_runcom }}"
    state: present
    create: yes
    insertafter: "pyenv init -"
    line: "    eval \"$(pyenv virtualenv-init -)\""
  when: pyenv_virtualenv
